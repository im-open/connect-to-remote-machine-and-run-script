name: 'Remote Windows Machine Script Execution'

description: 'This action connects to an on-premises hosted windows machine and executes a PowerShell script'

inputs:
  script-path:
    description: 'The local repository path to the script to be executed on the remote machine'
    required: true
  script-arguments:
    description: 'A pipe delimited string, `|`, that contains the arguments for the script - Example: `arg1|arg2|arg3`'
    required: false
  server:
    description: 'The name of the target server'
    required: true
  service-account-id:
    description: 'The service account name'
    required: true
  service-account-password:
    description: 'The service account password'
    required: true
  server-cert-path:
    description: 'Path to remote server public ssl cert, only necessary if the cert is not already installed on the actions runner'
    required: false
    default: ''

runs:
  using: 'composite'
  steps:
    - name: Remote Execution
      shell: powershell
      run: |
        $secure_password = ConvertTo-SecureString -String "${{ inputs.service-account-password }}" -AsPlainText -Force
        ${{ github.action_path }}/remote_action.ps1 `
          -script_path '${{ inputs.script-path }}' `
          -script_arguments '${{ inputs.script-arguments }}' `
          -server '${{ inputs.server }}' `
          -user_id '${{ inputs.service-account-id }}' `
          -password $secure_password `
          -cert_path '${{ inputs.server-cert-path }}'
